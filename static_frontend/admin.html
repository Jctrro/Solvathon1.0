<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StudySync — Admin Suite</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap"
    rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      height: 100%;
      overflow: hidden;
    }

    body {
      background: #0B0B0F;
      color: #F1F0FF;
      font-family: 'DM Sans', sans-serif;
    }

    ::-webkit-scrollbar {
      width: 5px;
      height: 5px;
    }

    ::-webkit-scrollbar-track {
      background: #0B0B0F;
    }

    ::-webkit-scrollbar-thumb {
      background: #8B5CF6;
      border-radius: 3px;
    }

    /* ── Fonts ── */
    .font-display {
      font-family: 'Syne', sans-serif;
    }

    /* ── Animations ── */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(12px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.96);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes pulseGlow {

      0%,
      100% {
        box-shadow: 0 0 0 0 rgba(139, 92, 246, 0);
      }

      50% {
        box-shadow: 0 0 18px 4px rgba(139, 92, 246, 0.35);
      }
    }

    .fade-in {
      animation: fadeIn 0.45s ease forwards;
    }

    .fade-in-scale {
      animation: fadeInScale 0.3s ease forwards;
    }

    /* ── Layout ── */
    #app {
      display: flex;
      height: 100vh;
      overflow: hidden;
      background: #0B0B0F;
    }

    /* ── Sidebar ── */
    #sidebar {
      width: 240px;
      background: #1E1B2E;
      border-right: 1px solid rgba(139, 92, 246, 0.12);
      display: flex;
      flex-direction: column;
      transition: width 0.3s ease;
      flex-shrink: 0;
      position: relative;
      z-index: 10;
      overflow: hidden;
    }

    #sidebar.collapsed {
      width: 68px;
    }

    #sidebar.collapsed .sidebar-text,
    #sidebar.collapsed .nav-section-label {
      display: none;
    }

    #sidebar.collapsed .nav-item {
      justify-content: center;
      padding: 10px;
    }

    #sidebar.collapsed .sidebar-logo-wrap {
      justify-content: center;
    }

    #sidebar.collapsed .sidebar-logo-wrap #logo-full {
      display: none;
    }

    #sidebar.collapsed .sidebar-logo-wrap #logo-icon {
      display: flex;
    }

    .sidebar-logo-wrap {
      padding: 24px 20px;
      border-bottom: 1px solid rgba(139, 92, 246, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-section-label {
      font-size: 10px;
      font-weight: 700;
      color: #374151;
      letter-spacing: 1px;
      text-transform: uppercase;
      padding: 10px 12px 6px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.18s ease;
      color: #9CA3AF;
      font-size: 13px;
      font-weight: 500;
    }

    .nav-item:hover {
      background: rgba(139, 92, 246, 0.12);
      color: #C4B5FD;
    }

    .nav-item.active {
      background: rgba(139, 92, 246, 0.2);
      color: #A78BFA;
      border-left: 3px solid #8B5CF6;
    }

    /* ── Navbar ── */
    #navbar {
      background: #141420;
      border-bottom: 1px solid rgba(139, 92, 246, 0.1);
      padding: 0 28px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    /* ── Main ── */
    #main-col {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-width: 0;
    }

    #content {
      flex: 1;
      overflow-y: auto;
      padding: 28px 32px;
    }

    /* ── Cards ── */
    .card {
      background: #141420;
      border: 1px solid rgba(139, 92, 246, 0.25);
      border-radius: 14px;
      transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 24px rgba(139, 92, 246, 0.3);
      border-color: rgba(139, 92, 246, 0.6);
    }

    /* ── Buttons ── */
    .btn-primary {
      background: linear-gradient(135deg, #8B5CF6, #6D28D9);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 9px 20px;
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
      letter-spacing: 0.3px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.45);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: rgba(139, 92, 246, 0.12);
      color: #C4B5FD;
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 8px;
      padding: 9px 20px;
      font-family: 'DM Sans', sans-serif;
      font-weight: 500;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-secondary:hover {
      background: rgba(139, 92, 246, 0.2);
    }

    .btn-danger {
      background: rgba(239, 68, 68, 0.12);
      color: #FCA5A5;
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 8px;
      padding: 6px 14px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'DM Sans', sans-serif;
    }

    .btn-danger:hover {
      background: rgba(239, 68, 68, 0.22);
      border-color: rgba(239, 68, 68, 0.55);
    }

    /* ── Inputs ── */
    .input-field {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(139, 92, 246, 0.2);
      border-radius: 8px;
      color: #F1F0FF;
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      padding: 10px 14px;
      width: 100%;
      outline: none;
      transition: border-color 0.2s ease;
    }

    .input-field:focus {
      border-color: rgba(139, 92, 246, 0.6);
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.1);
    }

    .input-field::placeholder {
      color: #4B5563;
    }

    .input-field option {
      background: #1E1B2E;
    }

    select.input-field {
      appearance: auto;
    }

    /* ── Table ── */
    table {
      border-collapse: collapse;
      width: 100%;
    }

    th {
      font-family: 'Syne', sans-serif;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.8px;
      text-transform: uppercase;
      color: #6B7280;
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    td {
      padding: 13px 16px;
      font-size: 13px;
      color: #D1D5DB;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    .table-row {
      transition: background 0.15s ease;
    }

    .table-row:hover td {
      background: rgba(139, 92, 246, 0.06);
    }

    /* ── Badges ── */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .badge-purple {
      background: rgba(139, 92, 246, 0.2);
      color: #C4B5FD;
      border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .badge-blue {
      background: rgba(59, 130, 246, 0.2);
      color: #93C5FD;
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .badge-red {
      background: rgba(239, 68, 68, 0.2);
      color: #FCA5A5;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .badge-green {
      background: rgba(16, 185, 129, 0.2);
      color: #6EE7B7;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .badge-yellow {
      background: rgba(245, 158, 11, 0.2);
      color: #FCD34D;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    /* ── Modal ── */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(6px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-box {
      background: #141420;
      border: 1px solid rgba(139, 92, 246, 0.35);
      border-radius: 16px;
      padding: 32px;
      width: min(540px, 95vw);
      max-height: 90vh;
      overflow-y: auto;
      animation: fadeInScale 0.25s ease;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 40px rgba(139, 92, 246, 0.1);
    }

    /* ── Gradient text ── */
    .gradient-text {
      background: linear-gradient(135deg, #8B5CF6, #C4B5FD);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* ── Search wrap ── */
    .search-wrap {
      position: relative;
    }

    .search-wrap .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #4B5563;
      pointer-events: none;
    }

    .search-wrap .input-field {
      padding-left: 38px;
    }

    /* ── Form label ── */
    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: #9CA3AF;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    /* ── Section title ── */
    .section-title {
      font-family: 'Syne', sans-serif;
      font-size: 22px;
      font-weight: 700;
      color: #F1F0FF;
    }

    /* ── View sections ── */
    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    /* ── Stat overview cards ── */
    .stat-card {
      padding: 24px 22px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .stat-icon-wrap {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-bar {
      height: 2px;
      border-radius: 2px;
    }

    /* ── Clock ── */
    #clock {
      color: #8B5CF6;
      font-weight: 600;
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div id="app">

    <!-- ══════════ SIDEBAR ══════════ -->
    <div id="sidebar">
      <div class="sidebar-logo-wrap">
        <div id="logo-full">
          <div class="font-display gradient-text" style="font-size:16px;font-weight:800;letter-spacing:-0.3px">StudySync
          </div>
          <div style="font-size:10px;color:#9CA3AF;margin-top:2px;letter-spacing:1px;text-transform:uppercase"
            class="sidebar-text">Admin Suite</div>
        </div>
        <div id="logo-icon"
          style="display:none;width:32px;height:32px;background:linear-gradient(135deg,#8B5CF6,#6D28D9);border-radius:8px;align-items:center;justify-content:center">
          <span class="font-display" style="font-size:14px;font-weight:800;color:white">S</span>
        </div>
      </div>

      <nav style="flex:1;padding:12px 8px;display:flex;flex-direction:column;gap:2px;overflow-y:auto">
        <div class="nav-section-label">Navigation</div>
        <div class="nav-item active" data-section="dashboard" onclick="navigate('dashboard',this)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"
            style="flex-shrink:0">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
          </svg>
          <span class="sidebar-text">Dashboard</span>
        </div>
        <div class="nav-item" data-section="students" onclick="navigate('students',this)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"
            style="flex-shrink:0">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
          </svg>
          <span class="sidebar-text">Students</span>
        </div>
        <div class="nav-item" data-section="faculty" onclick="navigate('faculty',this)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"
            style="flex-shrink:0">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span class="sidebar-text">Faculty</span>
        </div>
        <div class="nav-item" data-section="courses" onclick="navigate('courses',this)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"
            style="flex-shrink:0">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.966 8.966 0 00-6 2.292m0-14.25v14.25" />
          </svg>
          <span class="sidebar-text">Courses</span>
        </div>
        <div class="nav-item" data-section="notifications" onclick="navigate('notifications',this)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"
            style="flex-shrink:0">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
          </svg>
          <span class="sidebar-text">Dept Circulars</span>
        </div>
        <div class="nav-item" data-section="gatekeeper" onclick="navigate('gatekeeper',this)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"
            style="flex-shrink:0">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
          </svg>
          <span class="sidebar-text">Approvals</span>
        </div>
        <div class="nav-item" data-section="audit" onclick="navigate('audit',this)">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7"
            style="flex-shrink:0">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
          </svg>
          <span class="sidebar-text">Audit Logs</span>
        </div>
        <div style="margin-top:auto" class="nav-item" onclick="handleLogout()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7">
            <path
              d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" />
          </svg>
          <span class="sidebar-text">Sign Out</span>
        </div>
      </nav>
    </div>

    <!-- ══════════ MAIN ══════════ -->
    <div id="main-col">
      <div id="navbar">
        <div class="font-display" id="nav-title" style="font-size:16px;font-weight:700;color:#F1F0FF">StudySync — Admin
          Suite</div>
        <div style="display:flex;align-items:center;gap:20px">
          <div style="font-size:12px;color:#9CA3AF;text-align:right">
            <div id="nav-date">—</div>
            <div id="clock">—</div>
          </div>
          <div style="width:1px;height:30px;background:rgba(139,92,246,0.2)"></div>
          <div style="display:flex;align-items:center;gap:10px">
            <div id="admin-initial"
              style="width:36px;height:36px;background:linear-gradient(135deg,#8B5CF6,#6D28D9);border-radius:50%;display:flex;align-items:center;justify-content:center">
              <span class="font-display" style="font-size:13px;font-weight:700;color:white">A</span>
            </div>
            <div>
              <div id="admin-name" style="font-size:12px;font-weight:600;color:#F1F0FF">Admin</div>
              <div id="admin-dept" style="font-size:10px;color:#9CA3AF">Department</div>
            </div>
          </div>
        </div>
      </div>

      <main id="content">
        <!-- DASHBOARD -->
        <div id="view-dashboard" class="view active fade-in">
          <div class="card" style="padding:36px 40px;margin-bottom:28px;position:relative;overflow:hidden">
            <div
              style="position:absolute;top:0;right:0;width:320px;height:320px;background:radial-gradient(circle,rgba(139,92,246,0.15) 0%,transparent 70%);pointer-events:none">
            </div>
            <div style="position:relative">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">
                <span class="badge badge-green">System Status: Active</span>
                <span class="badge badge-purple">Admin Access</span>
              </div>
              <h1 class="font-display"
                style="font-size:32px;font-weight:800;color:#F1F0FF;line-height:1.2;margin-bottom:6px">
                Welcome back, <span class="gradient-text" id="dash-greeting-name">Administrator</span>
              </h1>
              <p style="color:#9CA3AF;font-size:14px">University Control Panel — Overview of all departments and active
                data.</p>
            </div>
          </div>
          <div id="overview-cards"
            style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:28px">
          </div>
        </div>

        <!-- STUDENTS -->
        <div id="view-students" class="view fade-in">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;gap:12px">
            <h2 class="section-title">Manage Students</h2>
            <button class="btn-primary" onclick="openStudentModal()">Add Student</button>
          </div>
          <div class="card" style="overflow:hidden">
            <div style="overflow-x:auto">
              <table>
                <thead>
                  <tr>
                    <th>USN</th>
                    <th>Name</th>
                    <th>Dept</th>
                    <th>Sem</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="student-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- FACULTY -->
        <div id="view-faculty" class="view fade-in">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;gap:12px">
            <h2 class="section-title">Manage Faculty</h2>
            <button class="btn-primary" onclick="openFacultyModal()">Add Faculty</button>
          </div>
          <div class="card" style="overflow:hidden">
            <div style="overflow-x:auto">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="faculty-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- COURSES -->
        <div id="view-courses" class="view fade-in">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;gap:12px">
            <h2 class="section-title">Course Management</h2>
            <button class="btn-primary" onclick="openCourseModal()">Add Course</button>
          </div>
          <div class="card" style="overflow:hidden">
            <div style="overflow-x:auto">
              <table>
                <thead>
                  <tr>
                    <th>Code</th>
                    <th>Name</th>
                    <th>Dept</th>
                    <th>Credits</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="course-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- NOTIFICATIONS -->
        <div id="view-notifications" class="view fade-in">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
            <h2 class="section-title" style="margin:0">Department Circulars</h2>
            <div style="display:flex;gap:12px">
              <button class="btn-primary" onclick="openNotifModal('INTERNAL')">+ Create Notification</button>
              <button class="btn-primary" onclick="openNotifModal('EMAIL')"
                style="background:linear-gradient(135deg, #06b6d4, #3b82f6)">Send Global Email Push</button>
            </div>
          </div>

          <div id="notif-grid"
            style="display:grid;grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));gap:20px">
            <!-- Populated by renderNotifications() -->
          </div>
        </div>

        <!-- APPROVALS (GATEKEEPER) -->
        <div id="view-gatekeeper" class="view fade-in">
          <h2 class="section-title" style="margin-bottom:20px;">Approvals — Pending Documents</h2>
          <div class="card" style="overflow:-hidden; margin-bottom: 40px;">
            <table>
              <thead>
                <tr>
                  <th>File Name</th>
                  <th>Subject</th>
                  <th>Sem</th>
                  <th>Unit</th>
                  <th>Uploader</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="gatekeeper-table-body"></tbody>
            </table>
          </div>

          <h2 class="section-title" style="margin-bottom:20px;">Approvals — Pending Accounts</h2>
          <div class="card" style="overflow:-hidden">
            <table>
              <thead>
                <tr>
                  <th>USN</th>
                  <th>Name</th>
                  <th>Dept</th>
                  <th>College Email</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="gatekeeper-accounts-body"></tbody>
            </table>
          </div>
        </div>

        <!-- AUDIT LOGS -->
        <div id="view-audit" class="view fade-in">
          <h2 class="section-title" style="margin-bottom:20px">System Audit Logs</h2>
          <div class="card" style="overflow:hidden">
            <div style="overflow-x:auto">
              <table>
                <thead>
                  <tr>
                    <th>Timestamp</th>
                    <th>Actor</th>
                    <th>Role</th>
                    <th>Action</th>
                    <th>Resource</th>
                    <th>Details</th>
                  </tr>
                </thead>
                <tbody id="audit-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- MODALS -->
  <div id="student-modal" class="modal-overlay" style="display:none"
    onclick="if(event.target===this)closeStudentModal()">
    <div class="modal-box">
      <h2 class="font-display" style="font-size:18px;font-weight:700;margin-bottom:20px">Add New Student</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px">
        <div><label class="form-label">USN</label><input class="input-field" id="s-usn"></div>
        <div><label class="form-label">Name</label><input class="input-field" id="s-name"></div>
        <div><label class="form-label">Semester</label>
          <select class="input-field" id="s-sem">
            <option value="1">Sem 1</option>
            <option value="3">Sem 3</option>
            <option value="5">Sem 5</option>
          </select>
        </div>
        <div><label class="form-label">Department</label>
          <select class="input-field" id="s-dept">
            <option>CSE</option>
            <option>ISE</option>
            <option>ECE</option>
          </select>
        </div>
        <div><label class="form-label">Status</label>
          <select class="input-field" id="s-status">
            <option value="ACTIVE">Active</option>
            <option value="SUSPENDED">Inactive</option>
          </select>
        </div>
        <div><label class="form-label">Email</label><input class="input-field" id="s-email"></div>
        <div><label class="form-label">Course (Initial Enrollment)</label>
          <select class="input-field" id="s-course-init">
            <option value="">No Course</option>
          </select>
        </div>
        <div><label class="form-label">Password</label><input class="input-field" id="s-pass" type="password"
            value="student123"></div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:10px">
        <button class="btn-secondary" onclick="closeStudentModal()">Cancel</button>
        <button class="btn-primary" onclick="saveStudent()">Add Student</button>
      </div>
    </div>
  </div>

  <div id="faculty-modal" class="modal-overlay" style="display:none"
    onclick="if(event.target===this)closeFacultyModal()">
    <div class="modal-box">
      <h2 class="font-display" style="font-size:18px;font-weight:700;margin-bottom:20px">Add Faculty</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px">
        <div><label class="form-label">ID</label><input class="input-field" id="f-id"></div>
        <div><label class="form-label">Name</label><input class="input-field" id="f-name"></div>
        <div><label class="form-label">Department</label><input class="input-field" id="f-dept-input"></div>
        <div><label class="form-label">Status</label>
          <select class="input-field" id="f-status">
            <option value="ACTIVE">Active</option>
            <option value="SUSPENDED">Inactive</option>
          </select>
        </div>
        <div><label class="form-label">Email</label><input class="input-field" id="f-email"></div>
        <div><label class="form-label">Password</label><input class="input-field" id="f-pass" type="password"
            value="faculty123"></div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:10px">
        <button class="btn-secondary" onclick="closeFacultyModal()">Cancel</button>
        <button class="btn-primary" onclick="saveFaculty()">Confirm</button>
      </div>
    </div>
  </div>

  <div id="course-modal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeCourseModal()">
    <div class="modal-box">
      <h2 class="font-display" style="font-size:18px;font-weight:700;margin-bottom:20px">New Course</h2>
      <div style="display:flex;flex-direction:column;gap:15px;margin-bottom:15px">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px">
          <div><label class="form-label">Code</label><input class="input-field" id="c-code"></div>
          <div><label class="form-label">Credits</label><input class="input-field" type="number" id="c-credits"
              value="3"></div>
        </div>
        <div><label class="form-label">Name</label><input class="input-field" id="c-name"></div>
        <div><label class="form-label">Department</label><input class="input-field" id="c-dept-input"></div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:10px">
        <button class="btn-secondary" onclick="closeCourseModal()">Close</button>
        <button class="btn-primary" onclick="saveCourse()">Create Course</button>
      </div>
    </div>
  </div>

  <div id="notif-modal" class="modal-overlay" style="display:none" onclick="if(event.target===this)closeNotifModal()">
    <div class="modal-box">
      <h2 id="notif-modal-title" class="font-display" style="font-size:18px;font-weight:700;margin-bottom:20px">Send New
        Announcement</h2>
      <div style="display:flex;flex-direction:column;gap:15px;margin-bottom:15px">
        <div><label class="form-label">Title</label><input class="input-field" id="n-title"></div>
        <div><label class="form-label">Message</label><textarea class="input-field" id="n-message" rows="4"></textarea>
        </div>
        <div><label class="form-label">Priority</label>
          <select class="input-field" id="n-priority">
            <option value="Low">Low</option>
            <option value="Medium" selected>Medium</option>
            <option value="High">High</option>
          </select>
        </div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:10px">
        <button class="btn-secondary" onclick="closeNotifModal()">Cancel</button>
        <button class="btn-primary" id="send-notif-btn" onclick="sendAdminNotification()">Send Now</button>
      </div>
    </div>
  </div>

  <script>
    let adminData = null;

    async function loadAdminDashboard() {
      try {
        console.log("Fetching dashboard data...");
        const res = await fetch('/api/admin/dashboard', { credentials: 'include' });
        if (!res.ok) {
          console.error("Dashboard fetch failed with status:", res.status);
          alert("Session expired or unauthorized. Redirecting to login.");
          window.location.href = '/';
          return;
        }
        const json = await res.json();
        adminData = json.data;
        console.log("Dashboard data loaded:", adminData);

        document.getElementById('admin-name').innerText = "UniAdmin " + (adminData.department || "");
        document.getElementById('admin-dept').innerText = adminData.department || "Admin";
        document.getElementById('dash-greeting-name').innerText = (adminData.department || "University") + " Admin";

        renderOverview();
      } catch (e) {
        console.error("Dashboard load error:", e);
        alert("A dashboard loading error occurred. Please check console.");
      }
    }

    function renderOverview() {
      const cards = [
        { label: `Students in ${adminData.department}`, value: adminData.dept_students, color: '#8B5CF6', bg: 'rgba(139,92,246,0.1)' },
        { label: 'Total Students (Global)', value: adminData.total_students, color: '#10B981', bg: 'rgba(16,185,129,0.1)' },
        { label: 'Total Courses', value: adminData.total_subjects, color: '#3B82F6', bg: 'rgba(59,130,246,0.1)' }
      ];
      document.getElementById('overview-cards').innerHTML = cards.map(c => `
    <div class="card stat-card">
      <div class="stat-icon-wrap" style="background:${c.bg}">
        <div style="width:12px;height:12px;border-radius:50%;background:${c.color}"></div>
      </div>
      <div class="font-display" style="font-size:32px;font-weight:800">${c.value}</div>
      <div style="font-size:12px;color:#9CA3AF">${c.label}</div>
    </div>
  `).join('');
    }

    async function populateCourseDropdowns() {
      const res = await fetch('/api/admin/courses', { credentials: 'include' });
      const json = await res.json();
      const options = json.data.map(c => `<option value="${c.id}">${c.code} — ${c.name}</option>`).join('');
      const select = document.getElementById('s-course-init');
      if (select) select.innerHTML = '<option value="">No Course</option>' + options;
    }

    async function navigate(section, el) {
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      if (el) el.classList.add('active');
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById('view-' + section).classList.add('active');
      document.getElementById('nav-title').innerText = section.toUpperCase();

      if (section === 'students') renderStudents();
      if (section === 'faculty') renderFaculty();
      if (section === 'courses') renderCourses();
      if (section === 'notifications') renderNotifications();
      if (section === 'gatekeeper') renderGatekeeper();
      if (section === 'audit') renderAuditLogs();
    }

    async function renderStudents() {
      await populateCourseDropdowns();
      const res = await fetch('/api/admin/students', { credentials: 'include' });
      const json = await res.json();
      const list = json.data;
      document.getElementById('student-table-body').innerHTML = list.map(s => `
    <tr>
      <td style="font-family:monospace;color:#8B5CF6">${s.usn}</td>
      <td style="font-weight:600">${s.name}</td>
      <td>${s.department}</td>
      <td>Sem ${s.semester}</td>
      <td style="color:#9CA3AF">${s.email}</td>
      <td><span class="badge ${s.status === 'ACTIVE' ? 'badge-green' : 'badge-red'}">${s.status}</span></td>
      <td>
        <button class="badge badge-red" style="cursor:pointer;border:none" onclick="removeStudent(${s.id})">Remove</button>
      </td>
    </tr>
  `).join('');
    }

    async function removeStudent(id) {
      if (!confirm("Are you sure you want to suspend this student?")) return;
      const res = await fetch(`/api/admin/students/${id}`, { method: 'DELETE', credentials: 'include' });
      if (res.ok) renderStudents();
      else alert("Failed to remove student.");
    }

    async function saveStudent() {
      const courseId = document.getElementById('s-course-init').value;
      const data = {
        usn: document.getElementById('s-usn').value,
        name: document.getElementById('s-name').value,
        semester: parseInt(document.getElementById('s-sem').value),
        department: document.getElementById('s-dept').value,
        branch: document.getElementById('s-dept').value,
        course_id: courseId ? parseInt(courseId) : null,
        status: document.getElementById('s-status').value,
        email: document.getElementById('s-email').value,
        password: document.getElementById('s-pass').value
      };
      const res = await fetch('/api/admin/students', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const resJson = await res.json();
      if (resJson.success) {
        closeStudentModal();
        renderStudents();
      } else {
        alert("Error: " + resJson.detail);
      }
    }

    async function renderFaculty() {
      const res = await fetch('/api/admin/faculty', { credentials: 'include' });
      const json = await res.json();
      document.getElementById('faculty-table-body').innerHTML = json.data.map(f => `
    <tr>
      <td>${f.employee_id}</td>
      <td>${f.name}</td>
      <td>${f.department}</td>
      <td>${f.email}</td>
      <td><span class="badge ${f.status === 'ACTIVE' ? 'badge-green' : 'badge-red'}">${f.status}</span></td>
      <td>
        <button class="badge badge-red" style="cursor:pointer;border:none" onclick="removeFaculty(${f.id})">Remove</button>
      </td>
    </tr>
  `).join('');
    }

    async function removeFaculty(id) {
      if (!confirm("Are you sure you want to suspend this faculty member?")) return;
      const res = await fetch(`/api/admin/faculty/${id}`, { method: 'DELETE', credentials: 'include' });
      if (res.ok) renderFaculty();
      else alert("Failed to remove faculty.");
    }

    async function saveFaculty() {
      const data = {
        employee_id: document.getElementById('f-id').value,
        name: document.getElementById('f-name').value,
        department: document.getElementById('f-dept-input').value,
        status: document.getElementById('f-status').value,
        email: document.getElementById('f-email').value,
        password: document.getElementById('f-pass').value
      };
      await fetch('/api/admin/faculty', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
      closeFacultyModal();
      renderFaculty();
    }

    async function renderCourses() {
      const res = await fetch('/api/admin/courses', { credentials: 'include' });
      const json = await res.json();
      document.getElementById('course-table-body').innerHTML = json.data.map(c => `
    <tr>
      <td>${c.code}</td>
      <td>${c.name}</td>
      <td>${c.department}</td>
      <td>${c.credits} Cr</td>
      <td>
        <button class="badge badge-red" style="cursor:pointer;border:none" onclick="removeCourse(${c.id})">Delete</button>
      </td>
    </tr>
  `).join('');
    }

    async function removeCourse(id) {
      if (!confirm("Are you sure you want to permanently delete this course?")) return;
      const res = await fetch(`/api/admin/courses/${id}`, { method: 'DELETE', credentials: 'include' });
      if (res.ok) renderCourses();
      else alert("Failed to delete course.");
    }

    async function saveCourse() {
      const data = {
        code: document.getElementById('c-code').value,
        credits: parseFloat(document.getElementById('c-credits').value),
        name: document.getElementById('c-name').value,
        department: document.getElementById('c-dept-input').value
      };
      await fetch('/api/admin/courses', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
      closeCourseModal();
      renderCourses();
    }

    async function renderNotifications() {
      try {
        const res = await fetch('/api/admin/notifications', { credentials: 'include' });
        const json = await res.json();
        const grid = document.getElementById('notif-grid');
        grid.innerHTML = json.data.map(n => {
          const isNew = (new Date() - new Date(n.timestamp)) < 86400000;
          return `
          <div class="card" style="padding:20px;border-left:4px solid ${n.priority === 'High' ? '#ef4444' : n.priority === 'Medium' ? '#f59e0b' : '#10b981'}">
            <div style="display:flex;justify-content:space-between;margin-bottom:10px">
              <span style="font-size:10px;font-weight:800;text-transform:uppercase;color:${n.priority === 'High' ? '#f87171' : n.priority === 'Medium' ? '#fbbf24' : '#34d399'}">${n.priority}</span>
              <span style="font-size:10px;color:rgba(255,255,255,0.3)">${new Date(n.timestamp).toLocaleDateString()}</span>
            </div>
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                <h3 style="font-size:14px;font-weight:700;margin:0;">${n.title}</h3>
                ${isNew ? '<span style="font-size:8px;font-weight:900;background:rgba(6,182,212,0.2);color:#22d3ee;padding:2px 6px;border-radius:4px;text-transform:uppercase;border:1px solid rgba(6,182,212,0.3);">New+</span>' : ''}
            </div>
            <p style="font-size:12px;color:rgba(255,255,255,0.6);line-height:1.6;margin:0;">${n.message}</p>
          </div>
        `}).join('');
      } catch (e) {
        console.error(e);
      }
    }

    async function renderGatekeeper() {
      // Fetch Files
      const fRes = await fetch('/api/admin/pending-files', { credentials: 'include' });
      const fJson = await fRes.json();
      document.getElementById('gatekeeper-table-body').innerHTML = fJson.data.map(f => `
        <tr>
          <td style="font-weight:600;color:white;">${f.filename}</td>
          <td><span class="badge badge-blue">${f.subject}</span></td>
          <td>Sem ${f.semester}</td>
          <td>Unit ${f.unit}</td>
          <td>${f.uploaded_by}</td>
          <td>
            <div style="display:flex;gap:8px">
              <a href="${f.filepath}" target="_blank" class="badge" style="background:rgba(255,255,255,0.1);color:white;cursor:pointer;border:none;text-decoration:none">View</a>
              <button class="badge badge-green" style="cursor:pointer;border:none" onclick="actOnFile(${f.id}, 'approve')">Approve</button>
              <button class="badge badge-red" style="cursor:pointer;border:none" onclick="actOnFile(${f.id}, 'deny')">Deny</button>
            </div>
          </td>
        </tr>
      `).join('');

      // Fetch Pending Accounts
      const aRes = await fetch('/api/admin/pending-accounts', { credentials: 'include' });
      const aJson = await aRes.json();
      const tbody = document.getElementById('gatekeeper-accounts-body');
      if (aJson.data && aJson.data.length > 0) {
        tbody.innerHTML = aJson.data.map(a => `
          <tr>
            <td style="font-family:monospace;color:#8B5CF6">${a.usn}</td>
            <td style="font-weight:600">${a.name}</td>
            <td>${a.department}</td>
            <td style="color:#9CA3AF">${a.email}</td>
            <td>
              <div style="display:flex;gap:8px">
                <button class="badge" style="background:rgba(255,255,255,0.1);color:white;cursor:pointer;border:none" onclick="alert('Student Info:\\nName: ${a.name}\\nUSN: ${a.usn}\\nDepartment: ${a.department}\\nEmail: ${a.email}')">Info</button>
                <button class="badge badge-green" style="cursor:pointer;border:none" onclick="actOnAccount(${a.id}, 'approve')">Approve</button>
                <button class="badge badge-red" style="cursor:pointer;border:none" onclick="actOnAccount(${a.id}, 'deny')">Deny</button>
              </div>
            </td>
          </tr>
        `).join('');
      } else {
        tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;color:gray;padding:24px;">No accounts pending approval.</td></tr>`;
      }
    }

    async function actOnFile(id, action) {
      const res = await fetch(`/api/admin/files/${id}/${action}`, { method: 'POST', credentials: 'include' });
      const json = await res.json();
      if (json.success) renderGatekeeper();
      else alert("Error processing file");
    }

    async function actOnAccount(id, action) {
      if (!confirm(`Are you sure you want to ${action} this account?`)) return;
      const res = await fetch(`/api/admin/accounts/${id}/${action}`, { method: 'POST', credentials: 'include' });
      const json = await res.json();
      if (json.success) renderGatekeeper();
      else alert("Error processing account");
    }

    async function renderAuditLogs() {
      const res = await fetch('/api/audit', { credentials: 'include' });
      const json = await res.json();
      document.getElementById('audit-table-body').innerHTML = json.logs.map(l => `
        <tr>
          <td style="font-size:11px;color:#9CA3AF">${l.timestamp}</td>
          <td style="font-weight:600">${l.actor}</td>
          <td><span class="badge ${l.role === 'ADMIN' ? 'badge-purple' : 'badge-blue'}">${l.role}</span></td>
          <td><span style="color:#F1F0FF">${l.action}</span></td>
          <td style="font-family:monospace;font-size:11px">${l.resource || '-'}</td>
          <td style="font-size:12px;color:#D1D5DB">${l.detail}</td>
        </tr>
      `).join('');
    }

    function handleLogout() { fetch('/api/auth/logout', { method: 'POST' }).then(() => window.location.href = '/'); }
    function openStudentModal() { document.getElementById('student-modal').style.display = 'flex'; }
    function closeStudentModal() { document.getElementById('student-modal').style.display = 'none'; }
    function openFacultyModal() { document.getElementById('faculty-modal').style.display = 'flex'; }
    function closeFacultyModal() { document.getElementById('faculty-modal').style.display = 'none'; }
    function openCourseModal() { document.getElementById('course-modal').style.display = 'flex'; }
    function closeCourseModal() { document.getElementById('course-modal').style.display = 'none'; }
    let currentNotifMode = 'INTERNAL';

    function openNotifModal(mode = 'INTERNAL') {
      currentNotifMode = mode;
      document.getElementById('notif-modal-title').innerText = mode === 'INTERNAL'
        ? 'Create Department Circular'
        : 'Push Global Email Announcement';
      document.getElementById('send-notif-btn').innerText = mode === 'INTERNAL'
        ? 'Send to Portal'
        : 'Push to All Emails';
      document.getElementById('notif-modal').style.display = 'flex';
    }

    function closeNotifModal() { document.getElementById('notif-modal').style.display = 'none'; }

    async function sendAdminNotification() {
      const title = document.getElementById('n-title').value;
      const message = document.getElementById('n-message').value;
      const priority = document.getElementById('n-priority').value;

      if (!title || !message) return alert("Please fill all fields");

      const btn = document.getElementById('send-notif-btn');
      const originalText = btn.innerText;
      btn.innerText = "Processing...";
      btn.disabled = true;

      const endpoint = currentNotifMode === 'INTERNAL' ? '/api/admin/notifications' : '/api/admin/push-email';

      try {
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, message, priority }),
          credentials: 'include'
        });
        const json = await res.json();
        if (res.ok) {
          alert(json.message || "Success!");
          closeNotifModal();
          document.getElementById('n-title').value = '';
          document.getElementById('n-message').value = '';
          renderNotifications();
        } else {
          alert("Error: " + (json.detail || "Failed to process request"));
        }
      } catch (e) {
        alert("Server connection error.");
      } finally {
        btn.innerText = originalText;
        btn.disabled = false;
      }
    }

    document.addEventListener('DOMContentLoaded', loadAdminDashboard);
    setInterval(() => {
      const now = new Date();
      document.getElementById('nav-date').innerText = now.toLocaleDateString();
      document.getElementById('clock').innerText = now.toLocaleTimeString();
    }, 1000);
  </script>
</body>

</html>